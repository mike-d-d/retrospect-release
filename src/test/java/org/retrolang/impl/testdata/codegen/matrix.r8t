if prep {
  _ = test(1, 2)
}
return [test (4, 3), test(2, 0)]

function test(n, m) {
  x = matrix([n, m]) | save
  x = matrix([m, n], x) | -> (# | save) | save
  for i in 1..min(m, n) sequential x {
    x[i, i][1] = -1
  }
  return x
}

/* CODEGEN test RETURNS
[ReshapedArray([3, 4], [[-1, 1], [1, 2], [1, 3], [2, 1], [2, 2], [-1, 3], [3, 1], [3, 2], [3, 3], [4, 1], [-1, 2], [4, 3]]),
ReshapedArray([0, 2], [])]
---
test_0(i1, i2):
   1: AtomicInteger.incrementAndGet(0);
   2: test I1 < 0; T:→ 153
   3: test I2 < 0; T:→ 153
   4: test I1 == 0; T:→ 153
   5: test I2 == 0; F:→ 50
   6: test I1 == 2; F:→ 153
   7: I7 ← 0;
   8: I4 ← 1;
   9: X3 ← [];
  10: I9 ← 0;
  11: I10 ← 0;
  12: I8 ← 1;
  13: I5 ← 0;
  14: I6 ← 0;
= 15: I11 ← Math.multiplyExact(I2, I1); ArithmeticException:→ 147
  16: test I2 == I1; F:→ 18
  17: test I1 == I2; T:→ 147
- 18: I12 ← Math.multiplyExact(I1, I2); ArithmeticException:→ 147
  19: test I12 == I11; F:→ 147
  20: test I2 == 0; F:→ 83
  21: test I1 == 2; F:→ 147
  22: X11 ← [];
= 23: test X3 is *[][b0, b1]@xxxx; F:→ 146
  24: I4 ← 0;
  25: I5 ← Frame1i2x.i0(X3);
= 26: test I4 < Frame1i2x.i0(X3); F:→ 99
  27: I6 ← iAdd(I4, 1);
  28: test 0 < I6; F:→ 137
  29: test I5 < I6; T:→ 137
  30: I7 ← uint8[](Frame1i2x.x0(X3), I4);
  31: I8 ← uint8[](Frame1i2x.x1(X3), I4);
  32: I10 ← iSub(I6, 1); ArithmeticException:→ 137
  33: I9 ← iAdd(iDiv(I10, I2), 1);
  34: test 0 < I9; F:→ 137
  35: test I1 < I9; T:→ 137
  36: I10 ← iAdd(iMod(I10, I2), 1);
  37: test 0 < I10; F:→ 137
  38: test I2 < I10; T:→ 137
  39: I9 ← Math.addExact(Math.multiplyExact(iSub(I9, 1), I2), iSub(I10, 1)); ArithmeticException:→ 137
  40: I4 ← iAdd(iDiv(I9, I1), 1);
  41: I9 ← iAdd(iMod(I9, I1), 1);
  42: I10 ← 0;
  43: I12 ← 0;
= 44: I13 ← iAdd(I10, 1);
  45: test I10 == 0; F:→ 86
  46: I14 ← I7;
= 47: test I13 == 1; F:→ 87
  48: I10 ← 1;
  49: I12 ← I14; → 44
- 50: I3 ← Math.multiplyExact(I1, I2); ArithmeticException:→ 153
  51: test TState.reserveForChange(X0, *[][b0, b1]@xxxx, null, I3) == 0; T:→ 153
  52: X3 ← alloc*[][b0, b1]@xxxx(X0, I3);
  53: I4 ← 0;
  54: I5 ← 1;
  55: I6 ← 0;
  56: I7 ← I1;
= 57: I6 ← iAdd(I6, 1);
  58: I8 ← 0;
  59: I9 ← I5;
  60: I10 ← I6;
= 61: test I1 < I9; T:→ 147
  62: test I2 < I10; T:→ 147
  63: I11 ← Math.addExact(Math.multiplyExact(iSub(I9, 1), I2), iSub(I10, 1)); ArithmeticException:→ 147
  64: test I11 < 0; T:→ 147
  65: test I11 < Frame1i2x.i0(X3); F:→ 147
  66: test I9 isUint8; F:→ 147
  67: setUint8[](Frame1i2x.x0(X3), I11, I9);
  68: test I10 isUint8; F:→ 147
  69: setUint8[](Frame1i2x.x1(X3), I11, I10);
  70: I4 ← 0;
  71: I5 ← I9;
  72: I6 ← I10;
  73: test I6 < I2; T:→ 57
  74: test I5 < I1; F:→ 80
  75: I5 ← iAdd(I5, 1);
  76: I8 ← 0;
  77: I9 ← I5;
  78: I10 ← 1;
  79: I6 ← 1; → 61
- 80: I9 ← 0;
  81: I10 ← 0;
  82: I8 ← 1; → 15
- 83: I11 ← Math.multiplyExact(I2, I1); ArithmeticException:→ 147
  84: test TState.reserveForChange(X0, *[][i0, b1]@xxxx, null, I11) == 0; T:→ 147
  85: X11 ← alloc*[][i0, b1]@xxxx(X0, I11); → 23
- 86: I14 ← I8; → 47
- 87: test 0 < I4; F:→ 131
  88: test I2 < I4; T:→ 131
  89: test 0 < I9; F:→ 131
  90: test I1 < I9; T:→ 131
  91: I7 ← Math.addExact(Math.multiplyExact(iSub(I4, 1), I1), iSub(I9, 1)); ArithmeticException:→ 131
  92: test X11 is *[][i0, b1]@xxxx; F:→ 131
  93: test I7 < 0; T:→ 131
  94: test I7 < Frame1i2x.i0(X11); F:→ 131
  95: X11 ← FrameLayout.ensureUnshared(*[][i0, b1]@xxxx, X0, X11);
  96: setInt[](Frame1i2x.x0(X11), iShl(I7, 2), I12);
  97: setUint8[](Frame1i2x.x1(X11), I7, I14);
  98: I4 ← I6; → 26
- 99: dropRef{X3};
 100: test I1 < I2; F:→ 124
 101: I3 ← I1;
 102: I4 ← 1;
=103: I5 ← Math.addExact(I4, 1); ArithmeticException:→ 126
 104: test 0 < I4; F:→ 126
 105: test I2 < I4; T:→ 126
 106: test I1 < I4; T:→ 126
 107: I6 ← Math.addExact(Math.multiplyExact(iSub(I4, 1), I1), iSub(I4, 1)); ArithmeticException:→ 126
 108: test X11 is *[][i0, b1]@xxxx; F:→ 126
 109: test I6 < 0; T:→ 126
 110: test I6 < Frame1i2x.i0(X11); F:→ 126
 111: I4 ← uint8[](Frame1i2x.x1(X11), I6);
 112: X11 ← FrameLayout.ensureUnshared(*[][i0, b1]@xxxx, X0, X11);
 113: setInt[](Frame1i2x.x0(X11), iShl(I6, 2), -1);
 114: setUint8[](Frame1i2x.x1(X11), I6, I4);
 115: I4 ← I5;
=116: test I3 < I4; F:→ 103
 117: TState.setResultTemplates(X0, [ReshapedArray([i0, i4], x0:*[]@xxxx)]);
 118: X3 ← TState.fnResults(X0, 1);
 119: X4 ← TState.fnResultBytes(X0, 8);
 120: setInt[](X4, 0, I2);
 121: setInt[](X4, 4, I1);
 122: setObject[](X3, 0, X11);
 123: return
-124: I3 ← I2;
 125: I4 ← 1; → 116
-126: X5 ← newStackEntry(LoopCore.Iterate.afterIterator {it=RangeIterator(I4, I3, None), loop=loop@9, state=loop@9_state⸨x=ReshapedArray([I2, I1], X11)⸩});
 127: X3 ← TState.fillStackEntry(X0, null, X5, loop@9_state⸨x=ReshapedArray([b0, b0], x0:*[]@xxxx)⸩, mMemo_8@xxxx, null);
 128: X1 ← TState.fillStackEntry(X0, X3, matrix.r8t+0:9_9 _t0 = iterate(_t0, EnumerateValues, loop@9, loop@9_state⸨x=x⸩), ReshapedArray([b0, b0], x0:*[]@xxxx), mMemo_x@xxxx, null);
=129: TState.setStackRest(X0, X1);
 130: return
-131: X7 ← newStackEntry(LoopCore.Iterate.afterNext {element=[[I4, I9], [I12, I14]], it=TransformedIterator(ReshapedIterator(ReshapedIterator(ArrayIterator(X3, EnumerateAllKeys, I6), [I5], [I1, I2]), [I1, I2], [I2, I1]), EnumerateAllKeys, lambda@8:26), loop=SaverLoop(SaveElements), state=ReshapedArray([I2, I1], X11)});
 132: X3 ← TState.fillStackEntry(X0, null, X7, [ReshapedArray([b0, b0], x0:*[]@xxxx), SaverLoop(SaveElements)], mMemo_29@xxxx, null);
=133: X3 ← TState.fillStackEntry(X0, X3, LoopCore.enumerateDefault, [ReshapedArray([b0, b0], x0:*[]@xxxx), SaverLoop(SaveElements)], mMemo_30@xxxx, null);
 134: X3 ← TState.fillStackEntry(X0, X3, LoopCore.PipeCollectionCollector.enumerate {loop=SaverLoop(SaveElements)}, ReshapedArray([b0, b0], x0:*[]@xxxx), mMemo_h38@xxxx, null);
 135: X4 ← newStackEntry(matrix.r8t+0:8_6 x = pipe(_t0, _t1) {n=I1, m=I2});
 136: X1 ← TState.fillStackEntry(X0, X3, X4, ReshapedArray([b0, b0], x0:*[]@xxxx), mMemo_x@xxxx, null); → 129
-137: X6 ← newStackEntry(ArrayCore.NextArrayIterator.startLoop {index=I4, it=ArrayIterator(X3, EnumerateAllKeys, I4)});
 138: X3 ← TState.fillStackEntry(X0, null, X6, [⸨[[b0], [b0, b0]]; Absent⸩, ArrayIterator(x0:*[]@xxxx, EnumerateAllKeys, b0), ReshapedIterator((empty), [b0], [b0, b0])], mMemo_1@xxxx, null);
 139: X4 ← newStackEntry(MatrixCore.NextReshapedIterator.next {it=ReshapedIterator((empty), [I5], [I1, I2])});
 140: X3 ← TState.fillStackEntry(X0, X3, X4, [⸨[[b0, b0], [b0, b0]]; Absent⸩, ReshapedIterator(ArrayIterator(x0:*[]@xxxx, EnumerateAllKeys, b0), [b0], [b0, b0]), ReshapedIterator((empty), [b0, b0], [b0, b0])], mMemo_2@xxxx, null);
 141: X4 ← newStackEntry(MatrixCore.NextReshapedIterator.next {it=ReshapedIterator((empty), [I1, I2], [I2, I1])});
 142: X3 ← TState.fillStackEntry(X0, X3, X4, [⸨[[b0, b0], [b0, b0]]; Absent⸩, ReshapedIterator(ReshapedIterator(ArrayIterator(x0:*[]@xxxx, EnumerateAllKeys, b0), [b0], [b0, b0]), [b0, b0], [b0, b0]), TransformedIterator((empty), EnumerateAllKeys, lambda@8:26)], mMemo_3@xxxx, null);
 143: X3 ← TState.fillStackEntry(X0, X3, CollectionCore.NextTransformedIterator.next {it=TransformedIterator(ToBeSet, EnumerateAllKeys, lambda@8:26)}, [⸨[[b0, b0], [b0, b0]]; Absent⸩, TransformedIterator(ReshapedIterator(ReshapedIterator(ArrayIterator(x0:*[]@xxxx, EnumerateAllKeys, b0), [b0], [b0, b0]), [b0, b0], [b0, b0]), EnumerateAllKeys, lambda@8:26), SaverLoop(SaveElements), ReshapedArray([b0, b0], x0:*[]@xxxx)], mMemo_19@xxxx, null);
 144: X4 ← newStackEntry(LoopCore.Iterate.next {loop=SaverLoop(SaveElements), state=ReshapedArray([I2, I1], X11)});
 145: X3 ← TState.fillStackEntry(X0, X3, X4, [ReshapedArray([b0, b0], x0:*[]@xxxx), SaverLoop(SaveElements)], mMemo_29@xxxx, null); → 133
-146: dropRef{X11};
-147: X11 ← newStackEntry(LoopCore.Iterate.afterNext {element=I8⸨0:[[I9, I10], [I9, I10]]; 1:Absent⸩, it=I4⸨0:BaseIterator(EnumerateAllKeys, [I5, I6], [I7, I2]); 1:ReshapedIterator(ArrayIterator([], EnumerateAllKeys, 0), [0], [2, 0])⸩, loop=SaverLoop(SaveElements), state=ReshapedArray([I1, I2], X3)});
 148: X3 ← TState.fillStackEntry(X0, null, X11, [ReshapedArray([b0, b0], x0:*[]@xxxx), SaverLoop(SaveElements)], mMemo_11@xxxx, null);
 149: X3 ← TState.fillStackEntry(X0, X3, LoopCore.enumerateDefault, [ReshapedArray([b0, b0], x0:*[]@xxxx), SaverLoop(SaveElements)], mMemo_12@xxxx, null);
 150: X3 ← TState.fillStackEntry(X0, X3, LoopCore.PipeCollectionCollector.enumerate {loop=SaverLoop(SaveElements)}, ReshapedArray([b0, b0], x0:*[]@xxxx), mMemo_20@xxxx, null);
 151: X4 ← newStackEntry(matrix.r8t+0:7_2 x = pipe(_t0, _t1) {n=I1, m=I2});
 152: X1 ← TState.fillStackEntry(X0, X3, X4, ReshapedArray([b0, b0], x0:*[]@xxxx), mMemo_x@xxxx, null); → 129
-153: X3 ← newStackEntry(matrix.r8t+0:7_0 _t0 = matrix([n, m]) {n=I1, m=I2});
 154: X1 ← TState.fillStackEntry(X0, null, X3, ReshapedArray([b0, b0], x0:*[]@xxxx), mMemo_x@xxxx, null); → 129
---
allocated=568/20, peak=368
*/
